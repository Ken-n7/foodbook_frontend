<div class="create-post-container mb-4">
  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-body p-3">
      <h6 class="card-title mb-3 fw-medium">Create a Post</h6>

      <!-- Restaurant Search -->
      <div class="mb-3">
        <div class="position-relative">
          <input
            id="restaurant-search"
            type="text"
            class="form-control form-control-sm rounded-2"
            placeholder="Search restaurant..."
            [formControl]="restaurantSearchControl"
            (input)="onSearchTermChange($event.target.value)"
            autocomplete="off"
          />

          <ul *ngIf="filteredRestaurants$ | async as restaurants" class="list-group position-absolute w-100 z-3 mt-1 shadow-sm rounded-2">
            <li
              *ngFor="let restaurant of restaurants"
              (click)="selectRestaurant(restaurant)"
              class="list-group-item list-group-item-action py-2"
            >
              {{ restaurant.name }}
            </li>
          </ul>
        </div>
      </div>

      <!-- Content -->
      <div class="mb-3">
        <textarea
          id="content"
          class="form-control form-control-sm rounded-2"
          rows="2"
          placeholder="Write something..."
          [formControl]="content"
        ></textarea>
      </div>

      <!-- Rating -->
      <div class="mb-3">
        <div class="d-flex align-items-center gap-2">
          <span class="small text-muted">Rating:</span>
          <div class="d-flex">
            <span
              *ngFor="let star of [1, 2, 3, 4, 5]"
              class="star fs-5"
              [class.text-warning]="rating.value >= star"
              [class.text-muted]="rating.value < star"
              (click)="setRating(star)"
              style="cursor: pointer;"
              >★</span
            >
          </div>
        </div>
      </div>

      <!-- Media Upload -->
      <div class="mb-3">
        <label for="media-upload" class="form-label small mb-1">Upload Media</label>
        <input
          id="media-upload"
          type="file"
          class="form-control form-control-sm"
          (change)="onMediaSelected($event)"
          multiple
          accept="image/*,video/*"
        />
      </div>

      <!-- Media Previews -->
      <div class="mb-3" *ngIf="mediaPreviews.length > 0">
        <div class="row g-2">
          <div *ngFor="let preview of mediaPreviews; let i = index" class="col-4">
            <div class="position-relative">
              <div class="ratio ratio-1x1 bg-light rounded-2 overflow-hidden">
                <img *ngIf="preview.startsWith('data:image')"
                     [src]="preview"
                     class="img-fluid object-fit-cover"
                     alt="Preview" />
                <video *ngIf="preview.startsWith('data:video')"
                       [src]="preview"
                       class="img-fluid object-fit-cover"
                       style="object-fit: cover;"></video>
              </div>
              <button type="button"
                      class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 rounded-circle"
                      style="width: 20px; height: 20px; padding: 0; font-size: 10px;"
                      (click)="removeMedia(i)">
                ×
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Submit -->
      <button type="button"
              class="btn btn-sm w-100 fw-medium rounded-2"
              [ngClass]="{'btn-primary': content.value || mediaPreviews.length > 0, 'btn-light': !content.value && mediaPreviews.length === 0}"
              [disabled]="!content.value && mediaPreviews.length === 0"
              (click)="submit()">
        Submit Post
      </button>
    </div>
  </div>
</div>
