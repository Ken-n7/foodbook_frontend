<div class="container my-4 d-flex justify-content-center p-2">
  <div class="d-flex align-items-center bg-white rounded-pill shadow-sm p-2 w-100 mx-auto shadow-lg"
    (click)="openCreatePostModal()">
    <div class="bg-orange text-white rounded-circle me-3 d-flex align-items-center justify-content-center fw-bold"
      style="width: 35px; height: 35px;">
      Y
    </div>
    <div class="text-muted fs-6">Share Food Experience?</div>
  </div>
</div>


<!-- Create Post Modal - Facebook Style + Orange Theme #ff7a00 -->
<div class="modal fade" id="createPostModal" tabindex="-1" aria-labelledby="createPostModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg overflow-hidden">

      <!-- Modal Header -->
      <div class="modal-header border-0 pb-0">
        <div class="w-100 text-center">
          <h5 class="modal-title fw-bold fs-4" id="createPostModalLabel">Create Post</h5>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body p-0">
        <div class="p-4">

          <!-- User Header -->
          <div class="d-flex align-items-center mb-4">
            <div
              class="bg-orange text-white rounded-circle d-flex align-items-center justify-content-center fw-bold me-3"
              style="width: 48px; height: 48px; font-size: 20px;">
              Y
            </div>
            <div>
              <div class="fw-bold">Your Name</div>
              <small class="text-muted">Public</small>
            </div>
          </div>

          <!-- Main Textarea -->
          <textarea #postTextarea class="form-control border-0 shadow-none resize-none" rows="5"
            placeholder="What's on your mind?" [formControl]="content"
            style="font-size: 1.4rem; outline: none;"></textarea>

          <!-- Restaurant Tag (shown only when selected) -->
          <div class="mt-3" *ngIf="restaurantId.value">
            <div class="d-inline-flex align-items-center bg-orange text-white rounded-pill px-4 py-2 fw-bold">
              <span>{{ restaurantSearchControl.value }}</span>
              <button type="button" class="btn-close btn-close-white ms-3" (click)="clearRestaurant()"></button>
            </div>
          </div>

          <!-- Restaurant Search Input (shown only if none selected) -->
          <div class="mt-3" *ngIf="!restaurantId.value">
            <div class="position-relative">
              <input id="restaurant-search" type="text" class="form-control form-control-lg rounded-pill ps-5"
                placeholder="Tag a restaurant (optional)" [formControl]="restaurantSearchControl"
                (input)="onSearchTermChange($event.target.value)" autocomplete="off">

              <!-- Search Icon -->
              <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-4 text-orange"></i>

              <!-- Dropdown Results -->
              <ul *ngIf="(filteredRestaurants$ | async) as restaurants"
                class="list-group position-absolute w-100 mt-2 shadow-lg rounded-3 overflow-hidden"
                style="z-index: 1050; max-height: 300px; overflow-y: auto;">
                <li *ngFor="let restaurant of restaurants || []" (click)="selectRestaurant(restaurant)"
                  class="list-group-item list-group-item-action py-3 px-4 fw-medium">
                  {{ restaurant.name }}
                </li>
              </ul>
            </div>
          </div>

          <!-- Media Previews -->
          <div class="mt-4" *ngIf="mediaPreviews.length > 0">
            <div class="row g-3">
              <div *ngFor="let preview of mediaPreviews; let i = index" class="col-6 col-md-4">
                <div class="position-relative rounded-4 overflow-hidden shadow">
                  <img *ngIf="preview.startsWith('data:image')" [src]="preview" class="img-fluid"
                    style="height: 200px; object-fit: cover;">
                  <video *ngIf="preview.startsWith('data:video')" [src]="preview" class="img-fluid"
                    style="height: 200px; object-fit: cover;"></video>

                  <button (click)="removeMedia(i)"
                    class="btn btn-danger btn-sm rounded-circle position-absolute top-0 end-0 m-2"
                    style="width: 32px; height: 32px;">
                    ×
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Bar -->
          <div class="border rounded-4 p-3 mt-4 bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-4">
                <!-- Photo/Video Upload -->
                <label class="text-success fw-bold" style="cursor: pointer;">
                  <i class="bi bi-image fs-4"></i> Photo/Video
                  <input type="file" multiple accept="image/*,video/*" (change)="onMediaSelected($event)" hidden>
                </label>

                <!-- Rating Stars -->
                <div class="d-flex align-items-center gap-2">
                  <span class="text-muted fw-medium">Rate:</span>
                  <div class="d-flex gap-1">
                    <span *ngFor="let star of [1,2,3,4,5]" class="fs-3" style="cursor: pointer;"
                      (click)="setRating(star)" [style.color]="rating.value >= star ? '#ff7a00' : '#ddd'">
                      ★
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <button class="btn btn-lg w-100 mt-4 fw-bold text-white rounded-pill py-3"
            [disabled]="!content.value?.trim() && mediaPreviews.length === 0"
            [style.background]="content.value?.trim() || mediaPreviews.length > 0 ? '#ff7a00' : '#ccc'"
            (click)="submit()">
            Post
          </button>

        </div>
      </div>
    </div>
  </div>
</div>
